{% extends "base.html" %}

{% block content %}
<div class="container d-flex justify-content-center align-items-center h-100">
    
    <div class="card shadow-lg rounded-4 login-card">
        <div class="card-body p-4 d-flex flex-column">
            
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                <div class="mb-3">
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }} py-2 text-center small rounded-3 mb-1">{{ message }}</div>
                    {% endfor %}
                </div>
                {% endif %}
            {% endwith %}

            <div class="text-center mb-4 mt-2">
                <i class="bi bi-cloud-sun-fill" style="font-size: 3rem; color: #ffce00; text-shadow: 2px 2px 0px #0d6efd;"></i>
                <h3 class="fw-bold mt-2" style="color: var(--bs-body-color);">Station Météo</h3>
            </div>

            <ul class="nav nav-tabs nav-fill mb-4 border-bottom-0" id="authTabs">
                <li class="nav-item">
                    <a class="nav-link active fw-bold tab-active" href="#" id="tab-login" onclick="showLogin()">Connexion</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-muted tab-inactive" href="#" id="tab-register" onclick="showRegister()">Inscription</a>
                </li>
            </ul>

            <form method="POST" id="mainForm" class="d-flex flex-column flex-grow-1">
                <input type="hidden" name="action" id="form-action" value="login">
                
                <div style="min-height: 250px;">
                    
                    <div class="mb-3">
                        <label class="form-label fw-semibold text-secondary small">Utilisateur</label>
                        <input type="text" name="user" class="form-control form-control-lg rounded-3" required>
                    </div>

                    <div class="mb-3" id="field-email" style="display: none;">
                        <label class="form-label fw-semibold text-secondary small">Adresse Email</label>
                        <input type="email" name="email" class="form-control form-control-lg rounded-3">
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-semibold text-secondary small">Mot de passe</label>
                        <input type="password" name="mdp" class="form-control form-control-lg rounded-3" required>
                    </div>

                    <div class="d-flex justify-content-end" id="link-forgot">
                        <a href="#" onclick="showForgot()" class="text-decoration-none small text-primary fw-semibold">Mot de passe oublié ?</a>
                    </div>
                </div>

                <div class="mt-auto text-center pt-3">
                    <button type="submit" class="btn btn-primary w-100 btn-lg rounded-3 fw-bold mb-3" id="btn-submit" style="background-color: #1a56db; border-color: #1a56db;">Connexion</button>
                    
                    <p class="small text-muted" id="bottom-text-login">
                        Pas encore de compte ? <a href="#" onclick="showRegister()" class="text-decoration-none fw-bold text-primary">Inscrivez-vous</a>
                    </p>
                    <p class="small text-muted" id="bottom-text-register" style="display:none;">
                        Déjà un compte ? <a href="#" onclick="showLogin()" class="text-decoration-none fw-bold text-primary">Connectez-vous</a>
                    </p>
                </div>
            </form>

            <form method="POST" id="forgotForm" style="display: none; height: 100%; flex-direction: column;">
                <input type="hidden" name="action" value="reset_password">
                <div style="flex-grow: 1; display: flex; flex-direction: column; justify-content: center;">
                    <h4 class="text-center fw-bold mb-3">Réinitialisation</h4>
                    <p class="text-center text-muted small mb-4">Entrez votre email pour recevoir un lien.</p>
                    <div class="mb-4">
                        <label class="form-label fw-semibold text-secondary small">Adresse Email</label>
                        <input type="email" name="email" class="form-control form-control-lg rounded-3">
                    </div>
                </div>
                <div class="mt-auto text-center">
                     <button type="submit" class="btn btn-warning w-100 btn-lg rounded-3 text-white fw-bold mb-3">Envoyer</button>
                     <a href="#" onclick="showLogin()" class="text-decoration-none small text-muted">Retour</a>
                </div>
            </form>

        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='js/login.js') }}"></script>
{% endblock %}