{% extends "base.html" %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/style.css' %}">

<div class="container d-flex justify-content-center align-items-center h-100">

    <div class="card shadow-lg rounded-4 auth-card">
        <div class="card-body p-4 d-flex flex-column position-relative">

            {% if messages %}
            <div class="alert-container">
                {% for message in messages %}
                <div class="alert alert-{{ message.tags }} py-2 text-center shadow rounded-pill">{{ message }}</div>
                {% endfor %}
            </div>
            {% endif %}

            <div class="text-center mb-4 mt-2">
                <div class="mb-2">
                    <i class="bi bi-cloud-sun-fill weather-icon"></i>
                </div>
                <h3 class="fw-bold" style="color: var(--bs-body-color);">Station Météo</h3>
            </div>

            <ul class="nav nav-tabs nav-fill mb-4 border-bottom-0" id="authTabs">
                <li class="nav-item">
                    <a class="nav-link nav-link-custom active-tab" href="#" id="tab-login"
                        onclick="showLogin()">Connexion</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link nav-link-custom text-muted" href="#" id="tab-register"
                        onclick="showRegister()">Inscription</a>
                </li>
            </ul>

            <form method="POST" id="mainForm" class="d-flex flex-column flex-grow-1">
                {% csrf_token %}
                <input type="hidden" name="action" id="form-action" value="login">

                <div class="form-content-area">

                    <div class="mb-3">
                        <label class="form-label fw-semibold text-secondary small">Utilisateur / Email</label>
                        <input type="text" name="identifiant" class="form-control form-control-lg rounded-3 fs-6"
                            required>
                    </div>

                    <div class="mb-3" id="field-email" style="display: none;">
                        <label class="form-label fw-semibold text-secondary small">Adresse Email</label>
                        <input type="email" name="email" class="form-control form-control-lg rounded-3 fs-6">
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-semibold text-secondary small">Mot de passe</label>
                        <div class="input-group">
                            <input type="password" name="mdp" id="passwordInput"
                                class="form-control form-control-lg rounded-start-3 fs-6" required>

                            <button class="btn btn-outline-secondary rounded-end-3" type="button"
                                onclick="togglePassword()">
                                <i class="bi bi-eye" id="passwordIcon"></i>
                            </button>
                        </div>
                    </div>

                    <div class="d-flex justify-content-end" id="link-forgot">
                        <a href="#" onclick="showForgot()"
                            class="text-decoration-none small text-primary fw-semibold">Mot de passe oublié ?</a>
                    </div>
                </div>

                <div class="mt-auto text-center">
                    <button type="submit" class="btn btn-primary w-100 btn-lg rounded-3 fw-bold mb-3 btn-auth"
                        id="btn-submit">Connexion</button>

                    <p class="small text-muted" id="bottom-text-login">
                        Pas encore de compte ? <a href="#" onclick="showRegister()"
                            class="text-decoration-none fw-bold text-primary">Inscrivez-vous</a>
                    </p>
                    <p class="small text-muted" id="bottom-text-register" style="display:none;">
                        Déjà un compte ? <a href="#" onclick="showLogin()"
                            class="text-decoration-none fw-bold text-primary">Connectez-vous</a>
                    </p>
                </div>
            </form>

            <form method="POST" id="forgotForm" class="forgot-container">
                <input type="hidden" name="action" value="reset_password">

                <div style="flex-grow: 1; display: flex; flex-direction: column; justify-content: center;">
                    <h4 class="text-center fw-bold mb-3">Réinitialisation</h4>
                    <p class="text-center text-muted small mb-4">Entrez votre email pour recevoir un lien.</p>

                    <div class="mb-4">
                        <label class="form-label fw-semibold text-secondary small">Adresse Email</label>
                        <input type="email" name="email" class="form-control form-control-lg rounded-3">
                    </div>
                </div>

                <div class="mt-auto text-center">
                    <button type="submit"
                        class="btn btn-warning w-100 btn-lg rounded-3 text-white fw-bold mb-3">Envoyer</button>
                    <a href="#" onclick="showLogin()" class="text-decoration-none small text-muted">Retour à la
                        connexion</a>
                </div>
            </form>

        </div>
    </div>
</div>

<script src="{% static 'js/login.js' %}"></script>
{% endblock %}