{% extends "base.html" %}
{% load static %}
{% block content %}
<div class="flex justify-between items-center mb-6">
    <h2 class="text-2xl font-bold text-gray-800 dark:text-white">Gestion du Système</h2>
    <span class="px-2 py-1 text-xs font-semibold text-white bg-gray-500 rounded-md">v1.0.0</span>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
        <!-- Postgres Status -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 p-4 flex items-center justify-between">
            <div class="flex items-center">
                <i class="bi bi-database-fill text-xl text-blue-500 mr-3"></i>
                <div>
                    <h5 class="font-bold text-gray-700 dark:text-gray-200">Postgres</h5>
                    <span class="text-xs text-gray-500">Base de données</span>
                </div>
            </div>
            {% if state.postgres %}
            <i class="bi bi-check-circle-fill text-green-500 text-xl"></i>
            {% else %}
            <i class="bi bi-x-circle-fill text-red-500 text-xl"></i>
            {% endif %}
        </div>

        <!-- InfluxDB Status -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 p-4 flex items-center justify-between">
            <div class="flex items-center">
                <i class="bi bi-activity text-xl text-purple-500 mr-3"></i>
                <div>
                    <h5 class="font-bold text-gray-700 dark:text-gray-200">InfluxDB</h5>
                    <span class="text-xs text-gray-500">Séries temporelles</span>
                </div>
            </div>
            {% if state.influxdb %}
            <i class="bi bi-check-circle-fill text-green-500 text-xl"></i>
            {% else %}
            <i class="bi bi-x-circle-fill text-red-500 text-xl"></i>
            {% endif %}
        </div>

        <!-- Network Status -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 p-4 flex items-center justify-between">
            <div class="flex items-center">
                <i class="bi bi-hdd-network text-xl text-orange-500 mr-3"></i>
                <div>
                    <h5 class="font-bold text-gray-700 dark:text-gray-200">Réseau</h5>
                    <span class="text-xs text-gray-500">Connectivité</span>
                </div>
            </div>
            {% if state.network %}
            <i class="bi bi-check-circle-fill text-green-500 text-xl"></i>
            {% else %}
            <i class="bi bi-x-circle-fill text-red-500 text-xl"></i>
            {% endif %}
        </div>

        <!-- TTN Status -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 p-4 flex items-center justify-between">
            <div class="flex items-center">
                <i class="bi bi-broadcast text-xl text-teal-500 mr-3"></i>
                <div>
                    <h5 class="font-bold text-gray-700 dark:text-gray-200">Capteurs</h5>
                    <span class="text-xs text-gray-500">Données &lt; 1h</span>
                </div>
            </div>
            {% if state.ttn %}
            <i class="bi bi-check-circle-fill text-green-500 text-xl"></i>
            {% else %}
            <i class="bi bi-exclamation-triangle-fill text-yellow-500 text-xl"></i>
            {% endif %}
        </div>
    </div>

    <div
        class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border-0 border-t-4 {% if state.update_available %}border-blue-500{% else %}border-green-500{% endif %} overflow-hidden flex flex-col h-full col-span-1 md:col-span-2">
        <div class="p-6 text-center flex flex-col justify-center h-full">

            {% if state.update_available %}
            <i class="bi bi-cloud-arrow-down text-5xl text-blue-500 mb-4"></i>
            <h4 class="text-xl font-bold text-gray-800 dark:text-white mb-2">Mise à jour disponible</h4>
            <p class="text-gray-500 dark:text-gray-400 mb-6">{{ state.updates_count }} paquets peuvent être mis à jour.</p>

            <form method="POST">
                {% csrf_token %}
                <input type="hidden" name="action" value="update_system">
                <button type="submit"
                    class="inline-flex items-center px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg transition-colors">
                    <i class="bi bi-download mr-2"></i> INSTALLER LES MISES À JOUR
                </button>
            </form>
            {% else %}
            <i class="bi bi-check-circle text-5xl text-green-500 mb-4"></i>
            <h4 class="text-xl font-bold text-gray-800 dark:text-white mb-2">Système à jour</h4>
            <p class="text-gray-500 dark:text-gray-400 mb-2">Dernière vérification: {{ state.last_update }}</p>
            <p class="text-gray-500 dark:text-gray-400 mb-6">Aucune action requise.</p>
            {% endif %}

        </div>
    </div>
</div>
{% endblock %}